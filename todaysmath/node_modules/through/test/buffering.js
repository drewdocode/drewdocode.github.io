var test=require("tape"),through=require("../");test("buffering",function(e){var t=through(function(e){this.queue(e)},function(){this.queue(null)}),u=!1,n=[];t.on("data",n.push.bind(n)),t.on("end",function(){u=!0}),t.write(1),t.write(2),t.write(3),e.deepEqual(n,[1,2,3]),t.pause(),t.write(4),t.write(5),t.write(6),e.deepEqual(n,[1,2,3]),t.resume(),e.deepEqual(n,[1,2,3,4,5,6]),t.pause(),t.end(),e.ok(!u),t.resume(),e.ok(u),e.end()}),test("buffering has data in queue, when ends",function(e){var t=through(function(e){this.queue(e)},function(){this.queue(null)}),u=!1,n=[];t.on("data",n.push.bind(n)),t.on("end",function(){u=!0}),t.pause(),t.write(1),t.write(2),t.write(3),t.end(),e.deepEqual(n,[],"no data written yet, still paused"),e.ok(!u,"end not emitted yet, still paused"),t.resume(),e.deepEqual(n,[1,2,3],"resumed, all data should be delivered"),e.ok(u,"end should be emitted once all data was delivered"),e.end()});