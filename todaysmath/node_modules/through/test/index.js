function write(e,n){function t(){for(;e.length;)if(!1===n.write(e.shift()))return n.once("drain",t);n.end()}e=e.slice(),t()}function read(e,n){var t=[];e.on("data",function(e){t.push(e)}),e.once("end",function(){n(null,t)}),e.once("error",function(e){n(e)})}var test=require("tape"),spec=require("stream-spec"),through=require("../");test("simple defaults",function(e){for(var n=1e3,t=[];n--;)t.push(n*Math.random());var r=through(),o=spec(r).through().pausable();read(r,function(n,r){e.ifError(n),e.deepEqual(r,t),e.end()}),r.on("close",o.validate),write(t,r)}),test("simple functions",function(e){for(var n=1e3,t=[];n--;)t.push(n*Math.random());var r=through(function(e){this.emit("data",2*e)}),o=spec(r).through().pausable();read(r,function(n,r){e.ifError(n),e.deepEqual(r,t.map(function(e){return 2*e})),e.end()}),r.on("close",o.validate),write(t,r)}),test("pauses",function(e){for(var n=1e3,t=[];n--;)t.push(n);var r=through(),o=spec(r).through().pausable();r.on("data",function(){Math.random()>.1||(r.pause(),process.nextTick(function(){r.resume()}))}),read(r,function(n,r){e.ifError(n),e.deepEqual(r,t)}),r.on("close",function(){o.validate(),e.end()}),write(t,r)}),test("does not soft-end on `undefined`",function(e){var n=through(),t=0;n.on("data",function(e){t++}),n.write(void 0),n.write(void 0),e.equal(t,2),e.end()});