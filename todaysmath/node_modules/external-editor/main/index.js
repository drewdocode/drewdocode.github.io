(function(){var t,r,e,i,n,o,c,s,u,h,a,p=function(t,r){return function(){return t.apply(r,arguments)}};i=require("fs"),a=require("tmp"),h=require("child_process").spawnSync,u=require("child_process").spawn,n=require("iconv-lite"),t=require("chardet"),r=require("./errors/CreateFileError"),c=require("./errors/ReadFileError"),s=require("./errors/RemoveFileError"),o=require("./errors/LaunchEditorError"),e=function(){function e(t){this.text=null!=t?t:"",this.launchEditorAsync=p(this.launchEditorAsync,this),this.launchEditor=p(this.launchEditor,this),this.removeTemporaryFile=p(this.removeTemporaryFile,this),this.readTemporaryFile=p(this.readTemporaryFile,this),this.createTemporaryFile=p(this.createTemporaryFile,this),this.determineEditor=p(this.determineEditor,this),this.cleanup=p(this.cleanup,this),this.runAsync=p(this.runAsync,this),this.run=p(this.run,this),this.determineEditor(),this.createTemporaryFile()}return e.edit=function(t){var r;return null==t&&(t=""),r=new e(t),r.run(),r.cleanup(),r.text},e.editAsync=function(t,r){var i;return null==t&&(t=""),i=new e(t),i.runAsync(function(t,e){var n;if(t)return r(t)in typeof r==="function";try{i.cleanup()}catch(t){n=t,"function"==typeof r&&r(n)}return r(null,e)})},e.CreateFileError=r,e.ReadFileError=c,e.RemoveFileError=s,e.LaunchEditorError=o,e.prototype.text="",e.prototype.temp_file=void 0,e.prototype.editor={bin:void 0,args:[]},e.prototype.run=function(){return this.launchEditor(),this.readTemporaryFile()},e.prototype.runAsync=function(t){var r;try{return this.launchEditorAsync(function(r){return function(){var e;try{if(r.readTemporaryFile(),"function"==typeof t)return t(null,r.text)}catch(r){if(e=r,"function"==typeof t)return t(e)}}}(this))}catch(e){if(r=e,"function"==typeof t)return t(r)}},e.prototype.cleanup=function(){return this.removeTemporaryFile()},e.prototype.determineEditor=function(){var t,r,e;return r=/^win/.test(process.platform)?"notepad":"vim",e=process.env.VISUAL||process.env.EDITOR||r,t=e.split(/\s+/),this.bin=t.shift(),this.args=t},e.prototype.createTemporaryFile=function(){var t;try{return this.temp_file=a.tmpNameSync({}),i.writeFileSync(this.temp_file,this.text,{encoding:"utf8"})}catch(e){throw t=e,new r(t)}},e.prototype.readTemporaryFile=function(){var r,e,o;try{return r=i.readFileSync(this.temp_file),r.length?(o=t.detect(r),this.text=n.decode(r,o)):this.text=""}catch(t){throw e=t,new c(e)}},e.prototype.removeTemporaryFile=function(){var t;try{return i.unlinkSync(this.temp_file)}catch(r){throw t=r,new s(t)}},e.prototype.launchEditor=function(){var t;try{return h(this.bin,this.args.concat([this.temp_file]),{stdio:"inherit"})}catch(r){throw t=r,new o(t)}},e.prototype.launchEditorAsync=function(t){var r,e;try{return r=u(this.bin,this.args.concat([this.temp_file]),{stdio:"inherit"}),r.on("exit",function(){if("function"==typeof t)return t()})}catch(t){throw e=t,new o(e)}},e}(),module.exports=e}).call(this);