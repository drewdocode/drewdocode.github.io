var fs=require("fs"),utf8=require("./encoding/utf8"),unicode=require("./encoding/unicode"),mbcs=require("./encoding/mbcs"),sbcs=require("./encoding/sbcs"),iso2022=require("./encoding/iso2022"),self=this,recognisers=[new utf8,new unicode.UTF_16BE,new unicode.UTF_16LE,new unicode.UTF_32BE,new unicode.UTF_32LE,new mbcs.sjis,new mbcs.big5,new mbcs.euc_jp,new mbcs.euc_kr,new mbcs.gb_18030,new iso2022.ISO_2022_JP,new iso2022.ISO_2022_KR,new iso2022.ISO_2022_CN,new sbcs.ISO_8859_1,new sbcs.ISO_8859_2,new sbcs.ISO_8859_5,new sbcs.ISO_8859_6,new sbcs.ISO_8859_7,new sbcs.ISO_8859_8,new sbcs.ISO_8859_9,new sbcs.windows_1251,new sbcs.windows_1256,new sbcs.KOI8_R];module.exports.detect=function(e){for(var n=[],s=0;s<256;s++)n[s]=0;for(var s=e.length-1;s>=0;s--)n[255&e[s]]++;for(var c=!1,s=128;s<=159;s+=1)if(0!=n[s]){c=!0;break}var i={fByteStats:n,fC1Bytes:c,fRawInput:e,fRawLength:e.length,fInputBytes:e,fInputLen:e.length},r=recognisers.map(function(e){return e.match(i)}).filter(function(e){return!!e}).sort(function(e,n){return e.confidence-n.confidence}).pop();return r?r.name:null},module.exports.detectFile=function(e,n,s){"function"==typeof n&&(s=n,n=void 0);var c,i=function(e,n){if(c&&fs.closeSync(c),e)return s(e,null);s(null,self.detect(n))};if(n&&n.sampleSize)return c=fs.openSync(e,"r"),sample=new Buffer(n.sampleSize),void fs.read(c,sample,0,n.sampleSize,null,function(e){i(e,sample)});fs.readFile(e,i)},module.exports.detectFileSync=function(e,n){if(n&&n.sampleSize){var s=fs.openSync(e,"r"),c=new Buffer(n.sampleSize);return fs.readSync(s,c,0,n.sampleSize),fs.closeSync(s),self.detect(c)}return self.detect(fs.readFileSync(e))};