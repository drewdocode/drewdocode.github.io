var fs=require("fs"),path=require("path"),browserify=require("browserify"),uglify=require("uglify-js"),pkg=process.argv[2],standalone=process.argv[3],compress=process.argv[4],packageDir=path.join(__dirname,"..");"."!=pkg&&(packageDir=path.join(packageDir,"node_modules",pkg));var json=require(path.join(packageDir,"package.json")),distDir=path.join(__dirname,"..","dist");fs.existsSync(distDir)||fs.mkdirSync(distDir);var bOpts={};standalone&&(bOpts.standalone=standalone),browserify(bOpts).require(path.join(packageDir,json.main),{expose:json.name}).bundle(function(r,s){r&&(console.error("browserify error:",r),process.exit(1));var e=path.join(distDir,json.name),n={warnings:!0,compress:{},output:{preamble:"/* "+json.name+" "+json.version+": "+json.description+" */"}};if(compress)for(var i=compress.split(","),a=0,o=i.length;a<o;++a){var p=i[a].split("=");n.compress[p[0]]=p.length<1||"false"!=p[1]}standalone&&(n.sourceMap={filename:json.name+".min.js",url:json.name+".min.js.map"});var t=uglify.minify(s.toString(),n);if(fs.writeFileSync(e+".min.js",t.code),t.map&&fs.writeFileSync(e+".min.js.map",t.map),standalone&&fs.writeFileSync(e+".bundle.js",s),t.warnings)for(var l=0,c=t.warnings.length;l<c;++l)console.warn("UglifyJS warning:",t.warnings[l])});