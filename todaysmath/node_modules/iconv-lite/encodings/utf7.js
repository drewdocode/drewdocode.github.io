function Utf7Codec(e,t){this.iconv=t}function Utf7Encoder(e,t){this.iconv=t.iconv}function Utf7Decoder(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=""}function Utf7IMAPCodec(e,t){this.iconv=t}function Utf7IMAPEncoder(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=new Buffer(6),this.base64AccumIdx=0}function Utf7IMAPDecoder(e,t){this.iconv=t.iconv,this.inBase64=!1,this.base64Accum=""}var Buffer=require("buffer").Buffer;exports.utf7=Utf7Codec,exports.unicode11utf7="utf7",Utf7Codec.prototype.encoder=Utf7Encoder,Utf7Codec.prototype.decoder=Utf7Decoder,Utf7Codec.prototype.bomAware=!0;var nonDirectChars=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g;Utf7Encoder.prototype.write=function(e){return new Buffer(e.replace(nonDirectChars,function(e){return"+"+("+"===e?"":this.iconv.encode(e,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))},Utf7Encoder.prototype.end=function(){};for(var base64Regex=/[A-Za-z0-9\/+]/,base64Chars=[],i=0;i<256;i++)base64Chars[i]=base64Regex.test(String.fromCharCode(i));var plusChar="+".charCodeAt(0),minusChar="-".charCodeAt(0),andChar="&".charCodeAt(0);Utf7Decoder.prototype.write=function(e){for(var t="",i=0,s=this.inBase64,c=this.base64Accum,r=0;r<e.length;r++)if(s){if(!base64Chars[e[r]]){if(r==i&&e[r]==minusChar)t+="+";else{var n=c+e.slice(i,r).toString();t+=this.iconv.decode(new Buffer(n,"base64"),"utf16-be")}e[r]!=minusChar&&r--,i=r+1,s=!1,c=""}}else e[r]==plusChar&&(t+=this.iconv.decode(e.slice(i,r),"ascii"),i=r+1,s=!0);if(s){var n=c+e.slice(i).toString(),o=n.length-n.length%8;c=n.slice(o),n=n.slice(0,o),t+=this.iconv.decode(new Buffer(n,"base64"),"utf16-be")}else t+=this.iconv.decode(e.slice(i),"ascii");return this.inBase64=s,this.base64Accum=c,t},Utf7Decoder.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e},exports.utf7imap=Utf7IMAPCodec,Utf7IMAPCodec.prototype.encoder=Utf7IMAPEncoder,Utf7IMAPCodec.prototype.decoder=Utf7IMAPDecoder,Utf7IMAPCodec.prototype.bomAware=!0,Utf7IMAPEncoder.prototype.write=function(e){for(var t=this.inBase64,i=this.base64Accum,s=this.base64AccumIdx,c=new Buffer(5*e.length+10),r=0,n=0;n<e.length;n++){var o=e.charCodeAt(n);32<=o&&o<=126?(t&&(s>0&&(r+=c.write(i.slice(0,s).toString("base64").replace(/\//g,",").replace(/=+$/,""),r),s=0),c[r++]=minusChar,t=!1),t||(c[r++]=o,o===andChar&&(c[r++]=minusChar))):(t||(c[r++]=andChar,t=!0),t&&(i[s++]=o>>8,i[s++]=255&o,s==i.length&&(r+=c.write(i.toString("base64").replace(/\//g,","),r),s=0)))}return this.inBase64=t,this.base64AccumIdx=s,c.slice(0,r)},Utf7IMAPEncoder.prototype.end=function(){var e=new Buffer(10),t=0;return this.inBase64&&(this.base64AccumIdx>0&&(t+=e.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),t),this.base64AccumIdx=0),e[t++]=minusChar,this.inBase64=!1),e.slice(0,t)};var base64IMAPChars=base64Chars.slice();base64IMAPChars[",".charCodeAt(0)]=!0,Utf7IMAPDecoder.prototype.write=function(e){for(var t="",i=0,s=this.inBase64,c=this.base64Accum,r=0;r<e.length;r++)if(s){if(!base64IMAPChars[e[r]]){if(r==i&&e[r]==minusChar)t+="&";else{var n=c+e.slice(i,r).toString().replace(/,/g,"/");t+=this.iconv.decode(new Buffer(n,"base64"),"utf16-be")}e[r]!=minusChar&&r--,i=r+1,s=!1,c=""}}else e[r]==andChar&&(t+=this.iconv.decode(e.slice(i,r),"ascii"),i=r+1,s=!0);if(s){var n=c+e.slice(i).toString().replace(/,/g,"/"),o=n.length-n.length%8;c=n.slice(o),n=n.slice(0,o),t+=this.iconv.decode(new Buffer(n,"base64"),"utf16-be")}else t+=this.iconv.decode(e.slice(i),"ascii");return this.inBase64=s,this.base64Accum=c,t},Utf7IMAPDecoder.prototype.end=function(){var e="";return this.inBase64&&this.base64Accum.length>0&&(e=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",e};