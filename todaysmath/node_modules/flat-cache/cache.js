var path=require("path"),fs=require("graceful-fs"),del=require("del").sync,utils=require("./utils"),writeJSON=utils.writeJSON,cache={load:function(e,t){var i=this;i._visited={},i._persisted={},i._pathToFile=t?path.resolve(t,e):path.resolve(__dirname,"./.cache/",e),fs.existsSync(i._pathToFile)&&(i._persisted=utils.tryParse(i._pathToFile,{}))},loadFile:function(e){var t=this,i=path.dirname(e),r=path.basename(e);t.load(r,i)},all:function(){return this._persisted},keys:function(){return Object.keys(this._persisted)},setKey:function(e,t){this._visited[e]=!0,this._persisted[e]=t},removeKey:function(e){delete this._visited[e],delete this._persisted[e]},getKey:function(e){return this._visited[e]=!0,this._persisted[e]},_prune:function(){var e=this,t={},i=Object.keys(e._visited);0!==i.length&&(i.forEach(function(i){t[i]=e._persisted[i]}),e._visited={},e._persisted=t)},save:function(e){var t=this;!e&&t._prune(),writeJSON(t._pathToFile,t._persisted)},removeCacheFile:function(){return del(this._pathToFile,{force:!0})},destroy:function(){var e=this;e._visited={},e._persisted={},e.removeCacheFile()}};module.exports={load:function(e,t){return this.create(e,t)},create:function(e,t){var i=Object.create(cache);return i.load(e,t),i},createFromFile:function(e){var t=Object.create(cache);return t.loadFile(e),t},clearCacheById:function(e,t){var i=t?path.resolve(t,e):path.resolve(__dirname,"./.cache/",e);return del(i,{force:!0}).length>0},clearAll:function(e){var t=e?path.resolve(e):path.resolve(__dirname,"./.cache/");return del(t,{force:!0}).length>0}};