function Prompt(){Base.apply(this,arguments),this.opt.choices||this.throwParamError("choices"),_.isArray(this.opt.default)&&this.opt.choices.forEach(function(e){this.opt.default.indexOf(e.value)>=0&&(e.checked=!0)},this),this.pointer=0,this.firstRender=!0,this.opt.default=null,this.paginator=new Paginator}function renderChoices(e,t){var i="",o=0;return e.forEach(function(e,r){if("separator"===e.type)return o++,void(i+=" "+e+"\n");if(e.disabled)o++,i+=" - "+e.name,i+=" ("+(_.isString(e.disabled)?e.disabled:"Disabled")+")";else{i+=r-o===t?chalk.cyan(figures.pointer):" ",i+=getCheckbox(e.checked)+" "+e.name}i+="\n"}),i.replace(/\n$/,"")}function getCheckbox(e){return e?chalk.green(figures.radioOn):figures.radioOff}var _=require("lodash"),util=require("util"),chalk=require("chalk"),cliCursor=require("cli-cursor"),figures=require("figures"),Base=require("./base"),observe=require("../utils/events"),Paginator=require("../utils/paginator");module.exports=Prompt,util.inherits(Prompt,Base),Prompt.prototype._run=function(e){this.done=e;var t=observe(this.rl),i=this.handleSubmitEvents(t.line.map(this.getCurrentValue.bind(this)));return i.success.forEach(this.onEnd.bind(this)),i.error.forEach(this.onError.bind(this)),t.normalizedUpKey.takeUntil(i.success).forEach(this.onUpKey.bind(this)),t.normalizedDownKey.takeUntil(i.success).forEach(this.onDownKey.bind(this)),t.numberKey.takeUntil(i.success).forEach(this.onNumberKey.bind(this)),t.spaceKey.takeUntil(i.success).forEach(this.onSpaceKey.bind(this)),t.aKey.takeUntil(i.success).forEach(this.onAllKey.bind(this)),t.iKey.takeUntil(i.success).forEach(this.onInverseKey.bind(this)),cliCursor.hide(),this.render(),this.firstRender=!1,this},Prompt.prototype.render=function(e){var t=this.getQuestion(),i="";if(this.firstRender&&(t+="(Press "+chalk.cyan.bold("<space>")+" to select, "+chalk.cyan.bold("<a>")+" to toggle all, "+chalk.cyan.bold("<i>")+" to inverse selection)"),"answered"===this.status)t+=chalk.cyan(this.selection.join(", "));else{var o=renderChoices(this.opt.choices,this.pointer),r=this.opt.choices.indexOf(this.opt.choices.getChoice(this.pointer));t+="\n"+this.paginator.paginate(o,r,this.opt.pageSize)}e&&(i=chalk.red(">> ")+e),this.screen.render(t,i)},Prompt.prototype.onEnd=function(e){this.status="answered",this.render(),this.screen.done(),cliCursor.show(),this.done(e.value)},Prompt.prototype.onError=function(e){this.render(e.isValid)},Prompt.prototype.getCurrentValue=function(){var e=this.opt.choices.filter(function(e){return Boolean(e.checked)&&!e.disabled});return this.selection=_.map(e,"short"),_.map(e,"value")},Prompt.prototype.onUpKey=function(){var e=this.opt.choices.realLength;this.pointer=this.pointer>0?this.pointer-1:e-1,this.render()},Prompt.prototype.onDownKey=function(){var e=this.opt.choices.realLength;this.pointer=this.pointer<e-1?this.pointer+1:0,this.render()},Prompt.prototype.onNumberKey=function(e){e<=this.opt.choices.realLength&&(this.pointer=e-1,this.toggleChoice(this.pointer)),this.render()},Prompt.prototype.onSpaceKey=function(){this.toggleChoice(this.pointer),this.render()},Prompt.prototype.onAllKey=function(){var e=Boolean(this.opt.choices.find(function(e){return"separator"!==e.type&&!e.checked}));this.opt.choices.forEach(function(t){"separator"!==t.type&&(t.checked=e)}),this.render()},Prompt.prototype.onInverseKey=function(){this.opt.choices.forEach(function(e){"separator"!==e.type&&(e.checked=!e.checked)}),this.render()},Prompt.prototype.toggleChoice=function(e){var t=this.opt.choices.getChoice(e);void 0!==t&&(this.opt.choices.getChoice(e).checked=!t.checked)};