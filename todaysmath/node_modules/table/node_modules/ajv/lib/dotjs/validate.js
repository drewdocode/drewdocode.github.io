module.exports=function(e,r,a){function t(e){for(var r=e.rules,a=0;a<r.length;a++)if(s(r[a]))return!0}function s(r){return void 0!==e.schema[r.keyword]||r.implements&&o(r)}function o(r){for(var a=r.implements,t=0;t<a.length;t++)if(void 0!==e.schema[a[t]])return!0}var l="",i=!0===e.schema.$async,n=e.util.schemaHasRulesExcept(e.schema,e.RULES.all,"$ref"),h=e.self._getId(e.schema);if(e.isTop&&(l+=" var validate = ",i&&(e.async=!0,l+="async "),l+="function(data, dataPath, parentData, parentDataProperty, rootData) { 'use strict'; ",h&&(e.opts.sourceCode||e.opts.processCode)&&(l+=" /*# sourceURL="+h+" */ ")),"boolean"==typeof e.schema||!n&&!e.schema.$ref){var c,d=e.level,f=e.dataLevel,p=e.schema["false schema"],u=e.schemaPath+e.util.getProperty("false schema"),v=e.errSchemaPath+"/false schema",m=!e.opts.allErrors,y="data"+(f||""),P="valid"+d;if(!1===e.schema){e.isTop?m=!0:l+=" var "+P+" = false; ";var g=g||[];g.push(l),l="",!1!==e.createErrors?(l+=" { keyword: '"+(c||"false schema")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: {} ",!1!==e.opts.messages&&(l+=" , message: 'boolean schema is false' "),e.opts.verbose&&(l+=" , schema: false , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),l+=" } "):l+=" {} ";var E=l;l=g.pop(),!e.compositeRule&&m?e.async?l+=" throw new ValidationError(["+E+"]); ":l+=" validate.errors = ["+E+"]; return false; ":l+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}else e.isTop?l+=i?" return data; ":" validate.errors = null; return true; ":l+=" var "+P+" = true; ";return e.isTop&&(l+=" }; return validate; "),l}if(e.isTop){var b=e.isTop,d=e.level=0,f=e.dataLevel=0,y="data";e.rootId=e.resolve.fullPath(e.self._getId(e.root.schema)),e.baseId=e.baseId||e.rootId,delete e.isTop,e.dataPathArr=[void 0],l+=" var vErrors = null; ",l+=" var errors = 0;     ",l+=" if (rootData === undefined) rootData = data; "}else{var d=e.level,f=e.dataLevel,y="data"+(f||"");if(h&&(e.baseId=e.resolve.url(e.baseId,h)),i&&!e.async)throw new Error("async schema in sync schema");l+=" var errs_"+d+" = errors;"}var c,P="valid"+d,m=!e.opts.allErrors,w="",S="",T=e.schema.type,D=Array.isArray(T);if(D&&1==T.length&&(T=T[0],D=!1),e.schema.$ref&&n){if("fail"==e.opts.extendRefs)throw new Error('$ref: validation keywords used in schema at path "'+e.errSchemaPath+'" (see option extendRefs)');!0!==e.opts.extendRefs&&(n=!1,e.logger.warn('$ref: keywords ignored in schema at path "'+e.errSchemaPath+'"'))}if(e.schema.$comment&&e.opts.$comment&&(l+=" "+e.RULES.all.$comment.code(e,"$comment")),T){if(e.opts.coerceTypes)var R=e.util.coerceToTypes(e.opts.coerceTypes,T);var $=e.RULES.types[T];if(R||D||!0===$||$&&!t($)){var u=e.schemaPath+".type",v=e.errSchemaPath+"/type",u=e.schemaPath+".type",v=e.errSchemaPath+"/type",k=D?"checkDataTypes":"checkDataType";if(l+=" if ("+e.util[k](T,y,!0)+") { ",R){var j="dataType"+d,L="coerced"+d;l+=" var "+j+" = typeof "+y+"; ","array"==e.opts.coerceTypes&&(l+=" if ("+j+" == 'object' && Array.isArray("+y+")) "+j+" = 'array'; "),l+=" var "+L+" = undefined; ";var A="",I=R;if(I)for(var U,_=-1,x=I.length-1;_<x;)U=I[_+=1],_&&(l+=" if ("+L+" === undefined) { ",A+="}"),"array"==e.opts.coerceTypes&&"array"!=U&&(l+=" if ("+j+" == 'array' && "+y+".length == 1) { "+L+" = "+y+" = "+y+"[0]; "+j+" = typeof "+y+";  } "),"string"==U?l+=" if ("+j+" == 'number' || "+j+" == 'boolean') "+L+" = '' + "+y+"; else if ("+y+" === null) "+L+" = ''; ":"number"==U||"integer"==U?(l+=" if ("+j+" == 'boolean' || "+y+" === null || ("+j+" == 'string' && "+y+" && "+y+" == +"+y+" ","integer"==U&&(l+=" && !("+y+" % 1)"),l+=")) "+L+" = +"+y+"; "):"boolean"==U?l+=" if ("+y+" === 'false' || "+y+" === 0 || "+y+" === null) "+L+" = false; else if ("+y+" === 'true' || "+y+" === 1) "+L+" = true; ":"null"==U?l+=" if ("+y+" === '' || "+y+" === 0 || "+y+" === false) "+L+" = null; ":"array"==e.opts.coerceTypes&&"array"==U&&(l+=" if ("+j+" == 'string' || "+j+" == 'number' || "+j+" == 'boolean' || "+y+" == null) "+L+" = ["+y+"]; ");l+=" "+A+" if ("+L+" === undefined) {   ";var g=g||[];g.push(l),l="",!1!==e.createErrors?(l+=" { keyword: '"+(c||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",l+=D?""+T.join(","):""+T,l+="' } ",!1!==e.opts.messages&&(l+=" , message: 'should be ",l+=D?""+T.join(","):""+T,l+="' "),e.opts.verbose&&(l+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),l+=" } "):l+=" {} ";var E=l;l=g.pop(),!e.compositeRule&&m?e.async?l+=" throw new ValidationError(["+E+"]); ":l+=" validate.errors = ["+E+"]; return false; ":l+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l+=" } else {  ";var C=f?"data"+(f-1||""):"parentData",V=f?e.dataPathArr[f]:"parentDataProperty";l+=" "+y+" = "+L+"; ",f||(l+="if ("+C+" !== undefined)"),l+=" "+C+"["+V+"] = "+L+"; } "}else{var g=g||[];g.push(l),l="",!1!==e.createErrors?(l+=" { keyword: '"+(c||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",l+=D?""+T.join(","):""+T,l+="' } ",!1!==e.opts.messages&&(l+=" , message: 'should be ",l+=D?""+T.join(","):""+T,l+="' "),e.opts.verbose&&(l+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),l+=" } "):l+=" {} ";var E=l;l=g.pop(),!e.compositeRule&&m?e.async?l+=" throw new ValidationError(["+E+"]); ":l+=" validate.errors = ["+E+"]; return false; ":l+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; "}l+=" } "}}if(e.schema.$ref&&!n)l+=" "+e.RULES.all.$ref.code(e,"$ref")+" ",m&&(l+=" } if (errors === ",l+=b?"0":"errs_"+d,l+=") { ",S+="}");else{var Q=e.RULES;if(Q)for(var $,O=-1,J=Q.length-1;O<J;)if($=Q[O+=1],t($)){if($.type&&(l+=" if ("+e.util.checkDataType($.type,y)+") { "),e.opts.useDefaults&&!e.compositeRule)if("object"==$.type&&e.schema.properties){var p=e.schema.properties,N=Object.keys(p),H=N;if(H)for(var q,z=-1,B=H.length-1;z<B;){q=H[z+=1];var F=p[q];if(void 0!==F.default){var G=y+e.util.getProperty(q);l+="  if ("+G+" === undefined) "+G+" = ","shared"==e.opts.useDefaults?l+=" "+e.useDefault(F.default)+" ":l+=" "+JSON.stringify(F.default)+" ",l+="; "}}}else if("array"==$.type&&Array.isArray(e.schema.items)){var K=e.schema.items;if(K)for(var F,_=-1,M=K.length-1;_<M;)if(F=K[_+=1],void 0!==F.default){var G=y+"["+_+"]";l+="  if ("+G+" === undefined) "+G+" = ","shared"==e.opts.useDefaults?l+=" "+e.useDefault(F.default)+" ":l+=" "+JSON.stringify(F.default)+" ",l+="; "}}var W=$.rules;if(W)for(var X,Y=-1,Z=W.length-1;Y<Z;)if(X=W[Y+=1],s(X)){var ee=X.code(e,X.keyword,$.type);ee&&(l+=" "+ee+" ",m&&(w+="}"))}if(m&&(l+=" "+w+" ",w=""),$.type&&(l+=" } ",T&&T===$.type&&!R)){l+=" else { ";var u=e.schemaPath+".type",v=e.errSchemaPath+"/type",g=g||[];g.push(l),l="",!1!==e.createErrors?(l+=" { keyword: '"+(c||"type")+"' , dataPath: (dataPath || '') + "+e.errorPath+" , schemaPath: "+e.util.toQuotedString(v)+" , params: { type: '",l+=D?""+T.join(","):""+T,l+="' } ",!1!==e.opts.messages&&(l+=" , message: 'should be ",l+=D?""+T.join(","):""+T,l+="' "),e.opts.verbose&&(l+=" , schema: validate.schema"+u+" , parentSchema: validate.schema"+e.schemaPath+" , data: "+y+" "),l+=" } "):l+=" {} ";var E=l;l=g.pop(),!e.compositeRule&&m?e.async?l+=" throw new ValidationError(["+E+"]); ":l+=" validate.errors = ["+E+"]; return false; ":l+=" var err = "+E+";  if (vErrors === null) vErrors = [err]; else vErrors.push(err); errors++; ",l+=" } "}m&&(l+=" if (errors === ",l+=b?"0":"errs_"+d,l+=") { ",S+="}")}}return m&&(l+=" "+S+" "),b?(i?(l+=" if (errors === 0) return data;           ",l+=" else throw new ValidationError(vErrors); "):(l+=" validate.errors = vErrors; ",l+=" return errors === 0;       "),l+=" }; return validate;"):l+=" var "+P+" = errors === errs_"+d+";",l=e.util.cleanUpCode(l),b&&(l=e.util.finalCleanUpCode(l,i)),l};