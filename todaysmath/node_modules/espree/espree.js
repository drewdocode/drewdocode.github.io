/**
 * @fileoverview Main Espree file that converts Acorn into Esprima output.
 *
 * This file contains code from the following MIT-licensed projects:
 * 1. Acorn
 * 2. Babylon
 * 3. Babel-ESLint
 *
 * This file also contains code from Esprima, which is BSD licensed.
 *
 * Acorn is Copyright 2012-2015 Acorn Contributors (https://github.com/marijnh/acorn/blob/master/AUTHORS)
 * Babylon is Copyright 2014-2015 various contributors (https://github.com/babel/babel/blob/master/packages/babylon/AUTHORS)
 * Babel-ESLint is Copyright 2014-2015 Sebastian McKenzie <sebmck@gmail.com>
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * * Redistributions of source code must retain the above copyright
 *   notice, this list of conditions and the following disclaimer.
 * * Redistributions in binary form must reproduce the above copyright
 *   notice, this list of conditions and the following disclaimer in the
 *   documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 *
 * Esprima is Copyright (c) jQuery Foundation, Inc. and Contributors, All Rights Reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 *   * Redistributions of source code must retain the above copyright
 *     notice, this list of conditions and the following disclaimer.
 *   * Redistributions in binary form must reproduce the above copyright
 *     notice, this list of conditions and the following disclaimer in the
 *     documentation and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL <COPYRIGHT HOLDER> BE LIABLE FOR ANY
 * DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND
 * ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF
 * THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 */

function resetExtra(){extra={tokens:null,range:!1,loc:!1,comment:!1,comments:[],tolerant:!1,errors:[],strict:!1,ecmaFeatures:{},ecmaVersion:DEFAULT_ECMA_VERSION,isModule:!1}}function normalizeEcmaVersion(e){if("number"!=typeof e)return DEFAULT_ECMA_VERSION;var t=e;switch(t>=2015&&(t-=2009),t){case 3:case 5:case 6:case 7:case 8:case 9:return t;default:throw new Error("Invalid ecmaVersion.")}}function isValidNode(e){var t=extra.ecmaFeatures;switch(e.type){case"ExperimentalSpreadProperty":case"ExperimentalRestProperty":return t.experimentalObjectRestSpread;case"ImportDeclaration":case"ExportNamedDeclaration":case"ExportDefaultDeclaration":case"ExportAllDeclaration":return extra.isModule;default:return!0}}function esprimaFinishNode(e){if(isValidNode(e)||this.unexpected(e.start),"TryStatement"===e.type?delete e.guardedHandlers:"CatchClause"===e.type&&delete e.guard,"TemplateElement"===e.type){var t="${"===this.input.slice(e.end,e.end+2);e.range&&(e.range[0]--,e.range[1]+=t?2:1),e.loc&&(e.loc.start.column--,e.loc.end.column+=t?2:1)}return"Literal"===e.type&&void 0===e.value&&(e.value=null),extra.attachComment&&commentAttachment.processComment(e),e.type.indexOf("Function")>-1&&!e.generator&&(e.generator=!1),e}function isValidToken(e){var t=extra.ecmaFeatures;switch(e.type){case tt.jsxName:case tt.jsxText:case tt.jsxTagStart:case tt.jsxTagEnd:return t.jsx;case tt.regexp:return!(extra.ecmaVersion<6&&e.value.flags&&e.value.flags.indexOf("y")>-1);default:return!0}}function wrapFinishNode(e){return function(t,r,n,a){var o=e.call(this,t,r,n,a);return esprimaFinishNode.call(this,o)}}function tokenize(e,t){var r,n,a,o=new TokenTranslator(tt,e);r=String,"string"==typeof e||e instanceof String||(e=r(e)),lookahead=null,t=assign({},t);var s={ecmaVersion:DEFAULT_ECMA_VERSION,plugins:{espree:!0}};resetExtra(),t.tokens=!0,extra.tokens=[],extra.range="boolean"==typeof t.range&&t.range,s.ranges=extra.range,extra.loc="boolean"==typeof t.loc&&t.loc,s.locations=extra.loc,extra.comment="boolean"==typeof t.comment&&t.comment,extra.comment&&(s.onComment=function(){var e=convertAcornCommentToEsprimaComment.apply(this,arguments);extra.comments.push(e)}),extra.tolerant="boolean"==typeof t.tolerant&&t.tolerant,s.ecmaVersion=extra.ecmaVersion=normalizeEcmaVersion(t.ecmaVersion),t.ecmaFeatures&&"object"==typeof t.ecmaFeatures&&(extra.ecmaFeatures=assign({},t.ecmaFeatures),a=extra.ecmaFeatures.impliedStrict,extra.ecmaFeatures.impliedStrict="boolean"==typeof a&&a);try{for(var i=acorn.tokenizer(e,s);(lookahead=i.getToken()).type!==tt.eof;)o.onToken(lookahead,extra);n=extra.tokens,extra.comment&&(n.comments=extra.comments),extra.tolerant&&(n.errors=extra.errors)}catch(e){throw e}return n}function convertAcornCommentToEsprimaComment(e,t,r,n,a,o){var s={type:e?"Block":"Line",value:t};return"number"==typeof r&&(s.start=r,s.end=n,s.range=[r,n]),"object"==typeof a&&(s.loc={start:a,end:o}),s}function parse(e,t){var r,n,a,o=String,s={ecmaVersion:DEFAULT_ECMA_VERSION,plugins:{espree:!0}};return lastToken=null,"string"==typeof e||e instanceof String||(e=o(e)),resetExtra(),commentAttachment.reset(),void 0!==t&&(extra.range="boolean"==typeof t.range&&t.range,extra.loc="boolean"==typeof t.loc&&t.loc,extra.attachComment="boolean"==typeof t.attachComment&&t.attachComment,extra.loc&&null!==t.source&&void 0!==t.source&&(extra.source=o(t.source)),"boolean"==typeof t.tokens&&t.tokens&&(extra.tokens=[],n=new TokenTranslator(tt,e)),"boolean"==typeof t.comment&&t.comment&&(extra.comment=!0,extra.comments=[]),"boolean"==typeof t.tolerant&&t.tolerant&&(extra.errors=[]),extra.attachComment&&(extra.range=!0,extra.comments=[],commentAttachment.reset()),s.ecmaVersion=extra.ecmaVersion=normalizeEcmaVersion(t.ecmaVersion),"module"===t.sourceType&&(extra.isModule=!0,s.ecmaVersion<6&&(s.ecmaVersion=6,extra.ecmaVersion=6),s.sourceType="module"),t.ecmaFeatures&&"object"==typeof t.ecmaFeatures&&(extra.ecmaFeatures=assign({},t.ecmaFeatures),a=extra.ecmaFeatures.impliedStrict,extra.ecmaFeatures.impliedStrict="boolean"==typeof a&&a,t.ecmaFeatures.globalReturn&&(s.allowReturnOutsideFunction=!0)),s.onToken=function(e){extra.tokens&&n.onToken(e,extra),e.type!==tt.eof&&(lastToken=e)},(extra.attachComment||extra.comment)&&(s.onComment=function(){var e=convertAcornCommentToEsprimaComment.apply(this,arguments);extra.comments.push(e),extra.attachComment&&commentAttachment.addComment(e)}),extra.range&&(s.ranges=!0),extra.loc&&(s.locations=!0),extra.ecmaFeatures.jsx&&(s.plugins={jsx:!0,espree:!0})),r=acorn.parse(e,s),r.sourceType=extra.isModule?"module":"script",(extra.comment||extra.attachComment)&&(r.comments=extra.comments),extra.tokens&&(r.tokens=extra.tokens),r.range&&(r.range[0]=r.body.length?r.body[0].range[0]:r.range[0],r.range[1]=lastToken?lastToken.range[1]:r.range[1]),r.loc&&(r.loc.start=r.body.length?r.body[0].loc.start:r.loc.start,r.loc.end=lastToken?lastToken.loc.end:r.loc.end),r}var astNodeTypes=require("./lib/ast-node-types"),commentAttachment=require("./lib/comment-attachment"),TokenTranslator=require("./lib/token-translator"),acornJSX=require("acorn-jsx/inject"),rawAcorn=require("acorn"),acorn=acornJSX(rawAcorn),DEFAULT_ECMA_VERSION=5,lookahead,extra,lastToken,assign=Object.assign||function(e){for(var t=1;t<arguments.length;t++)if(null!==arguments[t]&&"object"==typeof arguments[t])for(var r=Object.keys(arguments[t]),n=0;n<r.length;n++)e[r[n]]=arguments[t][r[n]];return e},tt=acorn.tokTypes,getLineInfo=acorn.getLineInfo;tt.jsxAttrValueToken={},acorn.plugins.espree=function(e){e.extend("finishNode",wrapFinishNode),e.extend("finishNodeAt",wrapFinishNode),e.extend("next",function(e){return function(){return isValidToken(this)||this.unexpected(),e.call(this)}}),e.extend("checkLVal",function(e){return function(t,r,n){if(!extra.ecmaFeatures.experimentalObjectRestSpread||"ObjectPattern"!==t.type)return e.call(this,t,r,n);for(var a=0;a<t.properties.length;a++)-1===t.properties[a].type.indexOf("Experimental")&&this.checkLVal(t.properties[a].value,r,n)}}),e.extend("parseTopLevel",function(e){return function(t){return extra.ecmaFeatures.impliedStrict&&this.options.ecmaVersion>=5&&(this.strict=!0),e.call(this,t)}}),e.extend("toAssignable",function(e){return function(t,r,n){if(extra.ecmaFeatures.experimentalObjectRestSpread&&"ObjectExpression"===t.type){t.type="ObjectPattern";for(var a=0;a<t.properties.length;a++){var o=t.properties[a];"ExperimentalSpreadProperty"===o.type?o.type="ExperimentalRestProperty":"init"!==o.kind?this.raise(o.key.start,"Object pattern can't contain getter or setter"):this.toAssignable(o.value,r)}return t}return e.call(this,t,r,n)}}),e.parseObjectRest=function(){var e=this.startNode();return this.next(),e.argument=this.parseIdent(),this.type===tt.comma&&this.raise(this.start,"Unexpected trailing comma after rest property"),this.finishNode(e,"ExperimentalRestProperty")},e.extend("parseProperty",function(e){return function(t,r){if(extra.ecmaFeatures.experimentalObjectRestSpread&&this.type===tt.ellipsis){var n;return t?n=this.parseObjectRest():(n=this.parseSpread(),n.type="ExperimentalSpreadProperty"),n}return e.call(this,t,r)}}),e.extend("checkPropClash",function(e){return function(t,r,n){"ExperimentalRestProperty"!==t.type&&"ExperimentalSpreadProperty"!==t.type&&e.call(this,t,r,n)}}),e.raise=e.raiseRecoverable=function(e,t){var r=getLineInfo(this.input,e),n=new SyntaxError(t);throw n.index=e,n.lineNumber=r.line,n.column=r.column+1,n},e.unexpected=function(e){var t="Unexpected token";if(null!==e&&void 0!==e){if(this.pos=e,this.options.locations)for(;this.pos<this.lineStart;)this.lineStart=this.input.lastIndexOf("\n",this.lineStart-2)+1,--this.curLine;this.nextToken()}this.end>this.start&&(t+=" "+this.input.slice(this.start,this.end)),this.raise(this.start,t)},e.extend("jsx_readString",function(e){return function(t){var r=e.call(this,t);return this.type===tt.string&&(extra.jsxAttrValueToken=!0),r}})},exports.version=require("./package.json").version,exports.tokenize=tokenize,exports.parse=parse,exports.Syntax=function(){var e,t={};"function"==typeof Object.create&&(t=Object.create(null));for(e in astNodeTypes)astNodeTypes.hasOwnProperty(e)&&(t[e]=astNodeTypes[e]);return"function"==typeof Object.freeze&&Object.freeze(t),t}(),exports.VisitorKeys=function(){var e,t=require("./lib/visitor-keys"),r={};"function"==typeof Object.create&&(r=Object.create(null));for(e in t)t.hasOwnProperty(e)&&(r[e]=t[e]);return"function"==typeof Object.freeze&&Object.freeze(r),r}();