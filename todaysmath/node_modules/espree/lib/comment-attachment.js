var astNodeTypes=require("./ast-node-types"),extra={trailingComments:[],leadingComments:[],bottomRightStack:[],previousNode:null};module.exports={reset:function(){extra.trailingComments=[],extra.leadingComments=[],extra.bottomRightStack=[],extra.previousNode=null},addComment:function(e){extra.trailingComments.push(e),extra.leadingComments.push(e)},processComment:function(e){var t,n,a,m;if(!(e.type===astNodeTypes.Program&&e.body.length>0)){for(extra.trailingComments.length>0?extra.trailingComments[0].range[0]>=e.range[1]?(n=extra.trailingComments,extra.trailingComments=[]):extra.trailingComments.length=0:extra.bottomRightStack.length>0&&extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments&&extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(n=extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments,delete extra.bottomRightStack[extra.bottomRightStack.length-1].trailingComments);extra.bottomRightStack.length>0&&extra.bottomRightStack[extra.bottomRightStack.length-1].range[0]>=e.range[0];)t=extra.bottomRightStack.pop();if(t){if(t.leadingComments)if(t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0])e.leadingComments=t.leadingComments,delete t.leadingComments;else for(a=t.leadingComments.length-2;a>=0;--a)if(t.leadingComments[a].range[1]<=e.range[0]){e.leadingComments=t.leadingComments.splice(0,a+1);break}}else if(extra.leadingComments.length>0)if(extra.leadingComments[extra.leadingComments.length-1].range[1]<=e.range[0]){if(extra.previousNode)for(m=0;m<extra.leadingComments.length;m++)extra.leadingComments[m].end<extra.previousNode.end&&(extra.leadingComments.splice(m,1),m--);extra.leadingComments.length>0&&(e.leadingComments=extra.leadingComments,extra.leadingComments=[])}else{for(a=0;a<extra.leadingComments.length&&!(extra.leadingComments[a].range[1]>e.range[0]);a++);e.leadingComments=extra.leadingComments.slice(0,a),0===e.leadingComments.length&&delete e.leadingComments,n=extra.leadingComments.slice(a),0===n.length&&(n=null)}extra.previousNode=e,n&&(e.trailingComments=n),extra.bottomRightStack.push(e)}}};